<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenTrack Admin Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #3b82f6;
            --success: #10b981;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --text-main: #f8fafc;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            background: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        
        .container-fluid { padding: 0; }
        
        .header {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            background: linear-gradient(135deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .btn-logout {
            background: var(--danger);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .tabs {
            display: flex;
            gap: 20px;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(30, 41, 59, 0.5);
        }
        
        .tab-btn {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            font-size: 1rem;
            padding: 0;
            transition: all 0.2s;
        }
        
        .tab-btn.active {
            color: var(--primary);
            border-bottom: 2px solid var(--primary);
        }
        
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .table-container {
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.8);
        }
        
        input, select {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-main);
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        input:focus, select:focus {
            border-color: var(--primary);
            outline: none;
        }
        
        .btn-add {
            background: var(--success);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .btn-edit, .btn-delete {
            padding: 4px 8px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            margin-right: 4px;
        }
        
        .btn-edit {
            background: var(--primary);
            color: white;
        }
        
        .btn-delete {
            background: var(--danger);
            color: white;
        }
        
        .form-container {
            background: rgba(30, 41, 59, 0.5);
            padding: 20px;
            border-radius: 8px;
            max-width: 500px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="header">
            <h1><i class="fas fa-sliders"></i> OpenTrack Admin Panel</h1>
            <button class="btn-logout" onclick="logout()">Logout</button>
        </div>
        
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('buses')">Buses</button>
            <button class="tab-btn" onclick="switchTab('routes')">Routes</button>
            <button class="tab-btn" onclick="switchTab('users')">Users</button>
        </div>
        
        <!-- Buses Tab -->
        <div class="tab-content active" id="buses-tab">
            <button class="btn-add" onclick="showBusForm()"><i class="fas fa-plus"></i> Add Bus</button>
            
            <div id="busForm" class="form-container" style="display: none; margin-bottom: 20px;">
                <h5>Add/Edit Bus</h5>
                <div class="form-group">
                    <label>Bus Number</label>
                    <input type="text" id="busNumber" placeholder="e.g., 001">
                </div>
                <div class="form-group">
                    <label>Plate Number</label>
                    <input type="text" id="plateNumber" placeholder="e.g., ABC-1234">
                </div>
                <div class="form-group">
                    <label>Model</label>
                    <input type="text" id="busModel" placeholder="e.g., Yutong">
                </div>
                <div class="form-group">
                    <label>Capacity</label>
                    <input type="number" id="capacity" placeholder="e.g., 50">
                </div>
                <div class="form-group">
                    <label>Year</label>
                    <input type="number" id="yearManufactured" placeholder="e.g., 2020">
                </div>
                <button class="btn-add" onclick="saveBus()">Save Bus</button>
                <button class="btn-logout" onclick="closeBusForm()" style="background: var(--danger);">Cancel</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Bus #</th>
                            <th>Plate</th>
                            <th>Model</th>
                            <th>Capacity</th>
                            <th>Year</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="busTable">
                        <tr><td colspan="7" style="text-align: center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Routes Tab -->
        <div class="tab-content" id="routes-tab">
            <button class="btn-add" onclick="showRouteForm()"><i class="fas fa-plus"></i> Add Route</button>
            
            <div id="routeForm" class="form-container" style="display: none; margin-bottom: 20px;">
                <h5>Add/Edit Route</h5>
                <div class="form-group">
                    <label>Route Code</label>
                    <input type="text" id="routeCode" placeholder="e.g., R001">
                </div>
                <div class="form-group">
                    <label>Route Name</label>
                    <input type="text" id="routeName" placeholder="e.g., Cubao to Ayala">
                </div>
                <div class="form-group">
                    <label>Origin</label>
                    <input type="text" id="origin" placeholder="e.g., Cubao">
                </div>
                <div class="form-group">
                    <label>Destination</label>
                    <input type="text" id="destination" placeholder="e.g., Ayala">
                </div>
                <div class="form-group">
                    <label>Distance (km)</label>
                    <input type="number" id="distanceKm" placeholder="e.g., 15.5" step="0.1">
                </div>
                <div class="form-group">
                    <label>Duration (minutes)</label>
                    <input type="number" id="estimatedDurationMinutes" placeholder="e.g., 45">
                </div>
                <div class="form-group">
                    <label>Fare (₱)</label>
                    <input type="number" id="fare" placeholder="e.g., 15.00" step="0.01">
                </div>
                <button class="btn-add" onclick="saveRoute()">Save Route</button>
                <button class="btn-logout" onclick="closeRouteForm()" style="background: var(--danger);">Cancel</button>
            </div>
            
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Code</th>
                            <th>Route</th>
                            <th>Distance</th>
                            <th>Duration</th>
                            <th>Fare</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="routeTable">
                        <tr><td colspan="7" style="text-align: center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Users Tab -->
        <div class="tab-content" id="users-tab">
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>Username</th>
                            <th>Name</th>
                            <th>Phone</th>
                            <th>Role</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="userTable">
                        <tr><td colspan="6" style="text-align: center;">Loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const token = localStorage.getItem('token');
        const role = localStorage.getItem('role');
        
        if (!token || role !== 'ADMIN') {
            window.location.href = '/index.html';
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            loadBuses();
            loadRoutes();
            loadUsers();
        });
        
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }
        
        async function loadBuses() {
            try {
                const response = await fetch('/api/buses', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const buses = await response.json();
                
                const table = document.getElementById('busTable');
                table.innerHTML = buses.map(bus => `
                    <tr>
                        <td>${bus.busNumber}</td>
                        <td>${bus.plateNumber}</td>
                        <td>${bus.model}</td>
                        <td>${bus.capacity}</td>
                        <td>${bus.yearManufactured}</td>
                        <td>${bus.status}</td>
                        <td>
                            <button class="btn-delete" onclick="deleteBus(${bus.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading buses:', error);
            }
        }
        
        async function loadRoutes() {
            try {
                const response = await fetch('/api/routes', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const routes = await response.json();
                
                const table = document.getElementById('routeTable');
                table.innerHTML = routes.map(route => `
                    <tr>
                        <td>${route.routeCode}</td>
                        <td>${route.routeName}</td>
                        <td>${route.distanceKm} km</td>
                        <td>${route.estimatedDurationMinutes} min</td>
                        <td>₱${route.fare.toFixed(2)}</td>
                        <td>${route.isActive ? 'Active' : 'Inactive'}</td>
                        <td>
                            <button class="btn-delete" onclick="deleteRoute(${route.id})">Delete</button>
                        </td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Error loading routes:', error);
            }
        }
        
        async function loadUsers() {
            try {
                const response = await fetch('/api/buses', { // Placeholder - replace with user endpoint
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const table = document.getElementById('userTable');
                table.innerHTML = '<tr><td colspan="6" style="text-align: center;">Coming soon</td></tr>';
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }
        
        function showBusForm() {
            document.getElementById('busForm').style.display = 'block';
        }
        
        function closeBusForm() {
            document.getElementById('busForm').style.display = 'none';
            clearBusForm();
        }
        
        function clearBusForm() {
            document.getElementById('busNumber').value = '';
            document.getElementById('plateNumber').value = '';
            document.getElementById('busModel').value = '';
            document.getElementById('capacity').value = '';
            document.getElementById('yearManufactured').value = '';
        }
        
        async function saveBus() {
            const bus = {
                busNumber: document.getElementById('busNumber').value,
                plateNumber: document.getElementById('plateNumber').value,
                model: document.getElementById('busModel').value,
                capacity: parseInt(document.getElementById('capacity').value),
                yearManufactured: parseInt(document.getElementById('yearManufactured').value),
                status: 'ACTIVE'
            };
            
            try {
                const response = await fetch('/api/buses', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(bus)
                });
                
                if (response.ok) {
                    closeBusForm();
                    loadBuses();
                    alert('Bus saved successfully');
                }
            } catch (error) {
                alert('Error saving bus: ' + error.message);
            }
        }
        
        async function deleteBus(id) {
            if (confirm('Delete this bus?')) {
                try {
                    const response = await fetch(`/api/buses/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    
                    if (response.ok) {
                        loadBuses();
                        alert('Bus deleted');
                    }
                } catch (error) {
                    alert('Error deleting bus');
                }
            }
        }
        
        function showRouteForm() {
            document.getElementById('routeForm').style.display = 'block';
        }
        
        function closeRouteForm() {
            document.getElementById('routeForm').style.display = 'none';
        }
        
        async function saveRoute() {
            const route = {
                routeCode: document.getElementById('routeCode').value,
                routeName: document.getElementById('routeName').value,
                origin: document.getElementById('origin').value,
                destination: document.getElementById('destination').value,
                distanceKm: parseFloat(document.getElementById('distanceKm').value),
                estimatedDurationMinutes: parseInt(document.getElementById('estimatedDurationMinutes').value),
                fare: parseFloat(document.getElementById('fare').value),
                isActive: true
            };
            
            try {
                const response = await fetch('/api/routes', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + token,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(route)
                });
                
                if (response.ok) {
                    closeRouteForm();
                    loadRoutes();
                    alert('Route saved successfully');
                }
            } catch (error) {
                alert('Error saving route: ' + error.message);
            }
        }
        
        async function deleteRoute(id) {
            if (confirm('Delete this route?')) {
                try {
                    const response = await fetch(`/api/routes/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': 'Bearer ' + token }
                    });
                    
                    if (response.ok) {
                        loadRoutes();
                        alert('Route deleted');
                    }
                } catch (error) {
                    alert('Error deleting route');
                }
            }
        }
        
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            localStorage.removeItem('role');
            window.location.href = '/index.html';
        }
    </script>
</body>
</html>
